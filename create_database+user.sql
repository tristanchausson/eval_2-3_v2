-- MySQL Script generated by MySQL Workbench
-- mar. 02 oct. 2018 14:23:39 CEST
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema epicerie_simplon
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema epicerie_simplon
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `epicerie_simplon` DEFAULT CHARACTER SET utf8 ;
USE `epicerie_simplon` ;

-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Categorie`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Categorie` (
  `idCategorie` INT NOT NULL AUTO_INCREMENT,
  `categorie_nom` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idCategorie`),
  UNIQUE INDEX `idCategorie_UNIQUE` (`idCategorie` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Unite`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Unite` (
  `idUnite` INT NOT NULL AUTO_INCREMENT,
  `unite_type` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idUnite`),
  UNIQUE INDEX `idUnite_UNIQUE` (`idUnite` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Fournisseurs`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Fournisseurs` (
  `idFournisseurs` INT NOT NULL AUTO_INCREMENT,
  `fournisseur_nom` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idFournisseurs`),
  UNIQUE INDEX `idFournisseurs_UNIQUE` (`idFournisseurs` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Sens`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Sens` (
  `idSens` INT NOT NULL AUTO_INCREMENT,
  `sens` TINYINT(1) NOT NULL,
  PRIMARY KEY (`idSens`),
  UNIQUE INDEX `idSens_UNIQUE` (`idSens` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Ventes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Ventes` (
  `idVentes` INT NOT NULL AUTO_INCREMENT,
  `date_vente` TIMESTAMP NOT NULL,
  PRIMARY KEY (`idVentes`),
  UNIQUE INDEX `idVentes_UNIQUE` (`idVentes` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Articles`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Articles` (
  `idArticles` INT NOT NULL AUTO_INCREMENT,
  `prix_vente` DECIMAL NOT NULL,
  `article_nom` VARCHAR(45) NOT NULL,
  `categorie_id` INT NOT NULL,
  `unite_id` INT NOT NULL,
  PRIMARY KEY (`idArticles`),
  UNIQUE INDEX `idArticles_UNIQUE` (`idArticles` ASC),
  INDEX `fk_categorie_id_idx` (`categorie_id` ASC),
  INDEX `fk_unite_id_idx` (`unite_id` ASC),
  CONSTRAINT `fk_categorie_id`
    FOREIGN KEY (`categorie_id`)
    REFERENCES `epicerie_simplon`.`Categorie` (`idCategorie`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_unite_id`
    FOREIGN KEY (`unite_id`)
    REFERENCES `epicerie_simplon`.`Unite` (`idUnite`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Articles_fournisseurs`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Articles_fournisseurs` (
  `article_id` INT NOT NULL,
  `fournisseur_id` INT NOT NULL,
  `prix_achat` DECIMAL NOT NULL,
  PRIMARY KEY (`article_id`, `fournisseur_id`),
  INDEX `fk_fournisseur_id_idx` (`fournisseur_id` ASC),
  CONSTRAINT `fk_article_id`
    FOREIGN KEY (`article_id`)
    REFERENCES `epicerie_simplon`.`Articles` (`idArticles`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_fournisseur_id`
    FOREIGN KEY (`fournisseur_id`)
    REFERENCES `epicerie_simplon`.`Fournisseurs` (`idFournisseurs`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Achats`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Achats` (
  `idAchats` INT NOT NULL AUTO_INCREMENT,
  `fournisseur_id` INT NOT NULL,
  `date_achat` TIMESTAMP NOT NULL,
  PRIMARY KEY (`idAchats`),
  UNIQUE INDEX `idAchats_UNIQUE` (`idAchats` ASC),
  INDEX `fk_fournisseur_id_idx` (`fournisseur_id` ASC),
  CONSTRAINT `fk_fournisseur_id2`
    FOREIGN KEY (`fournisseur_id`)
    REFERENCES `epicerie_simplon`.`Fournisseurs` (`idFournisseurs`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Type_mouvement`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Type_mouvement` (
  `idType_mouvement` INT NOT NULL AUTO_INCREMENT,
  `type` VARCHAR(45) NOT NULL,
  `sens_id` INT NOT NULL,
  PRIMARY KEY (`idType_mouvement`),
  UNIQUE INDEX `idType_mouvement_UNIQUE` (`idType_mouvement` ASC),
  INDEX `fk_send_id_idx` (`sens_id` ASC),
  CONSTRAINT `fk_send_id`
    FOREIGN KEY (`sens_id`)
    REFERENCES `epicerie_simplon`.`Sens` (`idSens`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `epicerie_simplon`.`Mouvements`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `epicerie_simplon`.`Mouvements` (
  `idMouvements` INT NOT NULL AUTO_INCREMENT,
  `article_id` INT NOT NULL,
  `type_mouvement_id` INT NOT NULL,
  `quantite` INT NOT NULL,
  `date_mouvement` TIMESTAMP NOT NULL,
  `achat_id` INT NULL,
  `vente_id` INT NULL,
  PRIMARY KEY (`idMouvements`),
  UNIQUE INDEX `idMouvements_UNIQUE` (`idMouvements` ASC),
  INDEX `fk_article_id_idx` (`article_id` ASC),
  INDEX `fk_achat_id_idx` (`achat_id` ASC),
  INDEX `fk_type_mouvement_id_idx` (`type_mouvement_id` ASC),
  INDEX `fk_vente_id_idx` (`vente_id` ASC),
  CONSTRAINT `fk_article_id`
    FOREIGN KEY (`article_id`)
    REFERENCES `epicerie_simplon`.`Articles` (`idArticles`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_achat_id`
    FOREIGN KEY (`achat_id`)
    REFERENCES `epicerie_simplon`.`Achats` (`idAchats`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_type_mouvement_id`
    FOREIGN KEY (`type_mouvement_id`)
    REFERENCES `epicerie_simplon`.`Type_mouvement` (`idType_mouvement`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_vente_id`
    FOREIGN KEY (`vente_id`)
    REFERENCES `epicerie_simplon`.`Ventes` (`idVentes`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE USER 'utilisateur_test' IDENTIFIED BY 'user_eval_23';

GRANT SELECT, INSERT, TRIGGER ON TABLE `epicerie_simplon`.* TO 'utilisateur_test';
GRANT SELECT, INSERT, TRIGGER, UPDATE, DELETE ON TABLE `epicerie_simplon`.* TO 'utilisateur_test';
GRANT SELECT ON TABLE `epicerie_simplon`.* TO 'utilisateur_test';

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
